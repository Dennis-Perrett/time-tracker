<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Bootstrap CSS -->
    
    <link href="https://fonts.googleapis.com/css2?family=Rubik+Moonrocks&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <title>When can I go?</title>
  </head>
  <body>
    <div id="main-body">
    <h1>When can I go?</h1>
    <div class="input-container">
      <label><span>Start time</span></label>
      <input type="tel" class="input" id="t1" maxlength="5" value="07:55"/>
    </div>
    <div class="input-container">
      <label><span>Time to work</span></label>
      <input type="tel" class="input" id="t2" maxlength="5" value="06:36"/>
    </div>
    <div class="input-container">
      <label><span>Breaks</span></label>
      <input type="tel" class="input" id="t3" maxlength="5" value="00:45"/>
    </div>



    <div id="motion-demo"></div>
    <div id="curved_div">
    
      <div class="output">
        <h3>You can go at</h3>
        <h2 id="leave-time">-</h2>
        <h6 id="countdown">Only 5:34 to go!</h6>
      
      </div>
    </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <script>

    
    function dot_inserter(input){
        if (event.key != 'Backspace' && input.value.length === 2){
        input.value += ':';
        }
      }

    function diff_calc(output){
      let s = document.getElementById("t1").value;
      let e = document.getElementById("t2").value;
      let b = document.getElementById("t3").value;
      
      
      output.innerHTML = diff(s, e, b)
    }

    function diff(start, end, br) {
      start = start.split(":");
      end = end.split(":");
      br = br.split(":")

      var new_time = (start[0]*60*60*1000) + (start[1]*60*1000) + (end[0]*60*60*1000) + (end[1]*60*1000) + (br[0]*60*60*1000) + (br[1]*60*1000);
      
      var hours = Math.floor(new_time / 1000 / 60 / 60);
      new_time -= hours * 1000 * 60 * 60;
      var minutes = Math.floor(new_time / 1000 / 60);

      console.log(hours, minutes)

      // If using time pickers with 24 hours format, add the below line get exact hours
      if (hours < 0)
        hours = hours + 24;
       
      if (minutes<10){
        minutes = '0'+minutes
      }

      return hours + ":" + minutes;
    }

    var t1 = document.querySelector('#t1');
    var t2 = document.querySelector('#t2');
    var t3 = document.querySelector('#t3');
    t1.addEventListener('keydown', function(e){dot_inserter(t1)});
    t2.addEventListener('keydown', function(e){dot_inserter(t2)});
    t3.addEventListener('keydown', function(e){dot_inserter(t3)});

    var t4 = document.querySelector('#leave-time');
    t1.addEventListener('keyup', function(e){diff_calc(t4)});
    t2.addEventListener('keyup', function(e){diff_calc(t4)});
    t3.addEventListener('keyup', function(e){diff_calc(t4)});

    
    function countdown(finishtime){
      let finish = finishtime.innerHTML.split(":");
      var today = new Date();
      var finish_date = new Date(today.getFullYear(), today.getMonth(), today.getDate(), finish[0], finish[1] );
      console.log(today);

      if (today > finish_date){
        finish_date = new Date(finish_date.getFullYear(), finish_date.getMonth(), finish_date.getDate()+1, finish[0], finish[1] );
      }
      console.log(finish_date);

      time_left = finish_date - today
      var hours = Math.floor(time_left / 1000 / 60 / 60);
      time_left -= hours * 1000 * 60 * 60;
      var minutes = Math.floor(time_left / 1000 / 60);
      
      if (minutes<10){
        minutes = '0'+minutes
      }
      
      document.getElementById("countdown").innerHTML = "Only " + hours + ":" + minutes + " to go!" + today.getSeconds()

    }

    window.onload = diff_calc(t4);
    window.onload = countdown(t4);
    setInterval(function(){countdown(t4)}, 1000)
    


    </script>
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
